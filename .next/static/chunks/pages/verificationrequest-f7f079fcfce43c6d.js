(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[868],{151:(e,t,a)=>{"use strict";a.d(t,{H:()=>s});let s="https://matrimonial-backend-7ahc.onrender.com"},1477:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(7876),l=a(4232),r=a(9516),n=a(7814);let c=e=>{let{setSearch:t,topSearch:a,setTopSearch:c}=e,[i,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(0),[x,h]=(0,l.useState)(!1),u=(0,l.useRef)(null),p="https://matrimonial-backend-7ahc.onrender.com",f=async()=>{try{let e=localStorage.getItem("token"),t=await fetch("".concat(p,"/admin/profile"),{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();if(!a.success)return;let s=a.data;!0===s.notifications?(0,n.cH)(s._id):(0,n.G1)()}catch(e){console.log("Admin Pref Error:",e)}};(0,l.useEffect)(()=>{f()},[]);let g=async()=>{try{let e=localStorage.getItem("token"),t=await fetch("".concat(p,"/api/notification/me"),{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();if(a.success){let e=a.data.reverse();o(e),m(e.filter(e=>!e.read).length)}}catch(e){console.log("Notification Fetch Error:",e)}};(0,l.useEffect)(()=>{g()},[]),(0,l.useEffect)(()=>{let e=(0,n.Ol)();if(e)return console.log("\uD83D\uDFE2 Verification Page Socket Active"),e.on("new-notification",e=>{o(t=>[e,...t]),m(e=>e+1)}),e.on("one-read",e=>{let{id:t}=e;o(e=>e.map(e=>e._id===t?{...e,read:!0}:e)),m(e=>Math.max(0,e-1))}),e.on("all-read",()=>{o(e=>e.map(e=>({...e,read:!0}))),m(0)}),e.on("delete-one",e=>{let{id:t}=e;o(e=>e.filter(e=>e._id!==t)),m(e=>Math.max(0,e-1))}),e.on("delete-all",()=>{o([]),m(0)}),()=>{e.off("new-notification"),e.off("one-read"),e.off("all-read"),e.off("delete-one"),e.off("delete-all")}},[]);let j=async e=>{var t;let a=localStorage.getItem("token");o(t=>t.map(t=>t._id===e?{...t,read:!0}:t)),m(e=>Math.max(0,e-1)),await fetch("".concat(p,"/api/notification/mark-read/").concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a)}}),null==(t=(0,n.Ol)())||t.emit("one-read",{id:e})},N=async()=>{var e;let t=localStorage.getItem("token");o(e=>e.map(e=>({...e,read:!0}))),m(0),await fetch("".concat(p,"/api/notification/mark-all"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)}}),null==(e=(0,n.Ol)())||e.emit("all-read")},b=async e=>{var t;let a=localStorage.getItem("token");o(t=>t.filter(t=>t._id!==e)),await fetch("".concat(p,"/api/notification/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}}),null==(t=(0,n.Ol)())||t.emit("delete-one",{id:e})},v=async()=>{var e;let t=localStorage.getItem("token");o([]),m(0),await fetch("".concat(p,"/api/notification/delete-all"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}}),null==(e=(0,n.Ol)())||e.emit("delete-all")};return(0,l.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.jsxs)("div",{className:"bg-gray-100 px-6 py-4 shadow-sm border-b fixed top-0 z-50 flex items-center justify-between",style:{left:"250px",width:"calc(100% - 250px)"},children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Verification Request"}),(0,s.jsxs)("div",{className:"flex items-center gap-5",children:[(0,s.jsxs)("div",{className:"flex items-center bg-white border border-gray-300 rounded-full px-4 py-2 w-[350px] shadow-sm",children:[(0,s.jsx)(r.A,{className:"text-gray-600",size:18}),(0,s.jsx)("input",{type:"text",placeholder:"Search By User ID",className:"ml-2 w-full outline-none bg-transparent",value:a,onChange:e=>{c(e.target.value),t(e.target.value)}})]}),(0,s.jsxs)("div",{className:"relative",ref:u,children:[(0,s.jsxs)("div",{onClick:()=>h(!x),className:"cursor-pointer",children:[(0,s.jsx)("svg",{width:"30",height:"30",viewBox:"0 0 24 24",fill:"#FFC107",children:(0,s.jsx)("path",{d:"M12 24c1.104 0 2-.897 2-2h-4c0 1.103.896 2 2 2zm6.707-5l1.293 1.293V21H4v-1.707L5.293 19H6v-7c0-3.309 2.691-6 6-6s6 2.691 6 6v7h.707z"})}),d>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 h-4 w-4 text-[10px] bg-red-600 text-white rounded-full flex items-center justify-center",children:d})]}),x&&(0,s.jsxs)("div",{className:"absolute right-0 mt-3 w-[350px] bg-white shadow-lg border rounded-lg p-3 z-50",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("h2",{className:"font-semibold",children:"Notifications"}),(0,s.jsx)("button",{onClick:N,className:"text-blue-600 text-sm",children:"Mark all read"})]}),(0,s.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:0===i.length?(0,s.jsx)("p",{className:"text-center py-3 text-gray-500",children:"No notifications"}):i.map(e=>(0,s.jsxs)("div",{className:"p-3 border-b ".concat(e.read?"":"bg-yellow-50"),children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("p",{className:"font-semibold",children:e.title}),(0,s.jsx)("button",{onClick:()=>b(e._id),className:"text-red-500 text-xs",children:"Delete"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700",children:e.message}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(e.createdAt).toLocaleString()}),!e.read&&(0,s.jsx)("button",{onClick:()=>j(e._id),className:"text-blue-600 text-xs mt-1",children:"Mark as read"})]},e._id))}),i.length>0&&(0,s.jsx)("button",{onClick:v,className:"w-full mt-2 py-2 text-sm text-red-600 border-t",children:"Delete All"})]})]})]})]})};var i=a(1713);let o=(0,i.A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),d=(0,i.A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var m=a(151);let x=e=>{var t,a,l;let{user:r}=e,n=((null==(t=r.firstName)?void 0:t[0])||"").toUpperCase()+((null==(a=r.lastName)?void 0:a[0])||"").toUpperCase();return(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[r.profileImage?(0,s.jsx)("img",{src:r.profileImage,className:"w-10 h-10 rounded-full object-cover"}):(0,s.jsx)("div",{className:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center text-sm font-semibold",children:n}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-semibold text-gray-900 text-sm",children:[r.firstName," ",r.lastName]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["#",r.id||(null==(l=r._id)?void 0:l.slice(-6))," / ",r.gender||"Not Mentioned"]})]})]})},h=e=>{var t,a;let{user:l,onClose:r}=e;return l?(0,s.jsx)("div",{id:"popup-bg",onClick:e=>{"popup-bg"===e.target.id&&r()},className:"fixed inset-0 bg-black/30 flex items-center justify-center z-[900]",children:(0,s.jsxs)("div",{className:"bg-white w-[260px] rounded-xl shadow-xl p-4 animate-fadeIn",children:[(0,s.jsx)("h3",{className:"text-center font-semibold text-sm mb-3",children:"Documents Uploaded"}),(0,s.jsxs)("div",{className:"max-h-[300px] overflow-y-auto space-y-3",children:[(null==(t=l.adhaarCard)?void 0:t.frontImage)&&(0,s.jsxs)("div",{className:"border rounded-xl shadow p-2",children:[(0,s.jsx)("img",{src:l.adhaarCard.frontImage,className:"w-full rounded-md"}),(0,s.jsx)("p",{className:"text-center text-xs mt-1 font-medium",children:"Aadhar Front"})]}),(null==(a=l.adhaarCard)?void 0:a.backImage)&&(0,s.jsxs)("div",{className:"border rounded-xl shadow p-2",children:[(0,s.jsx)("img",{src:l.adhaarCard.backImage,className:"w-full rounded-md"}),(0,s.jsx)("p",{className:"text-center text-xs mt-1 font-medium",children:"Aadhar Back"})]})]}),(0,s.jsx)("button",{onClick:r,className:"w-full bg-black text-white rounded-md py-1.5 mt-3 text-xs",children:"Close"})]})}):null};function u(){let[e,t]=(0,l.useState)([]),[a,n]=(0,l.useState)(null),[i,u]=(0,l.useState)(""),[p,f]=(0,l.useState)(""),[g,j]=(0,l.useState)(""),[N,b]=(0,l.useState)("Status"),[v,y]=(0,l.useState)("Gender"),[w,k]=(0,l.useState)(!0),[C,S]=(0,l.useState)(""),[A,E]=(0,l.useState)("asc"),[D,T]=(0,l.useState)(1),[_,M]=(0,l.useState)({totalRequestsThisWeek:0,pendingVerification:0,approvedThisWeek:0,rejectedDueToMismatch:0});(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat(m.H,"/admin/user-verify")),a=await e.json();t(a.data);let s=await fetch("https://matrimonial-backend-7ahc.onrender.com/admin/WeeklyRequestStats"),l=await s.json();M(l.data)}finally{k(!1)}})()},[]);let I=e=>{C===e?E("asc"===A?"desc":"asc"):(S(e),E("asc"))},z=(0,l.useMemo)(()=>{let t=[...e];return i&&(t=t.filter(e=>{var t,a,s;return(null==(t=e.firstName)?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null==(a=e.lastName)?void 0:a.toLowerCase().includes(i.toLowerCase()))||(null==(s=e._id)?void 0:s.includes(i))})),"Status"!==N&&(t=t.filter(e=>e.adminApprovel===N)),"Gender"!==v&&(t=t.filter(e=>e.gender===v)),"name"===C&&t.sort((e,t)=>"asc"===A?"".concat(e.firstName," ").concat(e.lastName).localeCompare("".concat(t.firstName," ").concat(t.lastName)):"".concat(t.firstName," ").concat(t.lastName).localeCompare("".concat(e.firstName," ").concat(e.lastName))),"date"===C&&t.sort((e,t)=>"asc"===A?new Date(e.createdAt)-new Date(t.createdAt):new Date(t.createdAt)-new Date(e.createdAt)),t},[e,i,N,v,C,A]),O=Math.ceil(z.length/5),L=Math.max(1,D-2),B=L+5-1;B>O&&(L=Math.max(1,(B=O)-5+1));let R=[];for(let e=L;e<=B;e++)R.push(e);let F=z.slice((D-1)*5,5*D);return(0,s.jsxs)("div",{className:"px-6 py-6",children:[(0,s.jsx)(c,{setSearch:u,topSearch:p,setTopSearch:f}),(0,s.jsxs)("div",{className:"pt-[px]",children:[(0,s.jsx)("div",{className:"flex justify-center gap-20 mb-10",children:[["Total Request This Week",_.totalRequestsThisWeek],["Pending Verification",_.pendingVerification],["Approved This Week",_.approvedThisWeek],["Rejected Due To Mismatch",_.rejectedDueToMismatch]].map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"w-[200px] bg-white border p-6 rounded-2xl shadow",children:[(0,s.jsx)("p",{className:"text-base font-semibold text-center",children:t}),(0,s.jsx)("h2",{className:"text-3xl font-black text-center mt-2",children:a})]},t)})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto p-5 border rounded-2xl bg-white shadow",children:[(0,s.jsxs)("div",{className:"bg-gray-100 border rounded-xl p-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"relative bg-white w-[300px]",children:[(0,s.jsx)(r.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5"}),(0,s.jsx)("input",{placeholder:"Search By User ID",value:g,onChange:e=>{j(e.target.value),u(e.target.value),T(1)},className:"w-full pl-10 pr-3 py-2 border rounded-lg text-sm"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("select",{value:N,onChange:e=>{b(e.target.value),T(1)},className:"border px-3 py-2 bg-gray-200 rounded-md",children:[(0,s.jsx)("option",{children:"Status"}),(0,s.jsx)("option",{value:"approved",children:"Approved"}),(0,s.jsx)("option",{value:"pending",children:"Pending"}),(0,s.jsx)("option",{value:"reject",children:"Rejected"})]}),(0,s.jsxs)("select",{value:v,onChange:e=>{y(e.target.value),T(1)},className:"border px-3 py-2 bg-gray-200 rounded-md",children:[(0,s.jsx)("option",{children:"Gender"}),(0,s.jsx)("option",{children:"Male"}),(0,s.jsx)("option",{children:"Female"})]})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto mt-5 rounded-xl border",children:w?(0,s.jsx)("div",{className:"flex justify-center py-10",children:(0,s.jsx)(o,{className:"animate-spin w-6 h-6"})}):(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-[#F7F7F7] text-gray-700",children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left font-semibold border-b",children:(0,s.jsxs)("button",{onClick:()=>I("name"),className:"flex items-center gap-1",children:["Reported User","name"===C?"asc"===A?"▲":"▼":"▲"]})}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-semibold border-b",children:(0,s.jsxs)("button",{onClick:()=>I("date"),className:"flex items-center gap-1",children:["Report Date","date"===C?"asc"===A?"▲":"▼":"▲"]})}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-semibold border-b",children:"Documents Submitted"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-semibold border-b",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-semibold border-b",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y",children:F.map(e=>{var t,a;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)(x,{user:e})}),(0,s.jsx)("td",{className:"px-4 py-3",children:new Date(e.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(null==(t=e.adhaarCard)?void 0:t.frontImage)||(null==(a=e.adhaarCard)?void 0:a.backImage)?"Aadhar Card":"No Document Submitted"}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded-full ".concat({approved:"bg-green-500",pending:"bg-yellow-500",reject:"bg-red-500"}[e.adminApprovel]||"bg-gray-400")}),(0,s.jsx)("span",{className:{approved:"text-green-600",pending:"text-yellow-600",reject:"text-red-600"}[e.adminApprovel]||"text-gray-600",children:e.adminApprovel})]})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsxs)("button",{onClick:()=>n(e),className:"flex items-center gap-1 text-blue-700",children:[(0,s.jsx)(d,{size:14})," View"]})})]},e._id)})})]})}),(0,s.jsxs)("div",{className:"flex justify-center mt-4 items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>T(e=>Math.max(1,e-1)),disabled:1===D,className:"text-gray-700 disabled:opacity-40",children:"‹ Prev"}),(0,s.jsx)("div",{className:"flex items-center gap-2 text-sm",children:R.map(e=>(0,s.jsx)("button",{onClick:()=>T(e),className:"".concat(D===e?"font-bold text-black underline":"text-gray-600"),children:e},e))}),(0,s.jsx)("button",{onClick:()=>T(e=>Math.min(O,e+1)),disabled:D===O,className:"text-gray-700 disabled:opacity-40",children:"Next ›"})]})]}),a&&(0,s.jsx)(h,{user:a,onClose:()=>n(null)})]})]})}let p=()=>{let[e,t]=(0,l.useState)("");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c,{onSearch:e=>t(e)}),(0,s.jsx)("div",{className:"pt-[90px]",children:(0,s.jsx)(u,{search:e})})]})}},2567:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/verificationrequest",function(){return a(1477)}])},7814:(e,t,a)=>{"use strict";a.d(t,{G1:()=>n,Ol:()=>c,cH:()=>r});var s=a(2692);let l=null;function r(e){return l&&l.connected||((l=(0,s.io)("https://matrimonial-backend-7ahc.onrender.com",{transports:["websocket"],secure:!0,reconnection:!0,reconnectionAttempts:10,path:"/socket.io",query:{adminId:e}})).on("connect",()=>{console.log("\uD83D\uDD35 SOCKET CONNECTED:",l.id)}),l.on("disconnect",()=>{console.log("\uD83D\uDD34 SOCKET DISCONNECTED")})),l}function n(){l&&(l.disconnect(),console.log("\uD83D\uDD34 SOCKET MANUALLY DISCONNECTED"))}function c(){return l}},9516:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1713).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])}},e=>{e.O(0,[692,636,593,792],()=>e(e.s=2567)),_N_E=e.O()}]);