(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[748],{151:(e,t,r)=>{"use strict";r.d(t,{H:()=>s});let s="https://matrimonial-backend-7ahc.onrender.com"},3703:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/reportedcontent",function(){return r(8256)}])},7814:(e,t,r)=>{"use strict";r.d(t,{G1:()=>n,Ol:()=>o,cH:()=>l});var s=r(2692);let a=null;function l(e){return a&&a.connected||((a=(0,s.io)("https://matrimonial-backend-7ahc.onrender.com",{transports:["websocket"],secure:!0,reconnection:!0,reconnectionAttempts:10,path:"/socket.io",query:{adminId:e}})).on("connect",()=>{console.log("\uD83D\uDD35 SOCKET CONNECTED:",a.id)}),a.on("disconnect",()=>{console.log("\uD83D\uDD34 SOCKET DISCONNECTED")})),a}function n(){a&&(a.disconnect(),console.log("\uD83D\uDD34 SOCKET MANUALLY DISCONNECTED"))}function o(){return a}},8256:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var s=r(7876),a=r(4232),l=r(2577),n=r(7814);let o=()=>{let[e,t]=(0,a.useState)([]),[r,o]=(0,a.useState)(0),[c,i]=(0,a.useState)(!1),d=(0,a.useRef)(null),x="https://matrimonial-backend-7ahc.onrender.com",m=async()=>{try{let e=localStorage.getItem("token"),t=await fetch("".concat(x,"/admin/profile"),{headers:{Authorization:"Bearer ".concat(e)}}),r=await t.json();if(!r.success)return;let s=r.data;!0===s.notifications?(0,n.cH)(s._id):(0,n.G1)()}catch(e){console.log("Admin Pref Error:",e)}};(0,a.useEffect)(()=>{m()},[]);let p=async()=>{try{let e=localStorage.getItem("token"),r=await fetch("".concat(x,"/api/notification/me"),{headers:{Authorization:"Bearer ".concat(e)}}),s=await r.json();if(s.success){let e=s.data.reverse();t(e),o(e.filter(e=>!e.read).length)}}catch(e){console.log("Fetch error:",e)}};(0,a.useEffect)(()=>{p()},[]),(0,a.useEffect)(()=>{let e=(0,n.Ol)();if(e)return console.log("\uD83D\uDFE2 REAL-TIME NOTIFICATION LISTENER ACTIVE"),e.on("new-notification",e=>{t(t=>[e,...t]),o(e=>e+1)}),e.on("one-read",e=>{let{id:r}=e;t(e=>e.map(e=>e._id===r?{...e,read:!0}:e)),o(e=>Math.max(0,e-1))}),e.on("all-read",()=>{t(e=>e.map(e=>({...e,read:!0}))),o(0)}),e.on("delete-one",e=>{let{id:r}=e;t(e=>e.filter(e=>e._id!==r))}),e.on("delete-all",()=>{t([]),o(0)}),()=>{e.off("new-notification"),e.off("one-read"),e.off("all-read"),e.off("delete-one"),e.off("delete-all")}},[]),(0,a.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let h=async e=>{var r;let s=localStorage.getItem("token");t(t=>t.map(t=>t._id===e?{...t,read:!0}:t)),o(e=>Math.max(0,e-1)),await fetch("".concat(x,"/api/notification/mark-read/").concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(s)}}),null==(r=(0,n.Ol)())||r.emit("one-read",{id:e})},u=async()=>{var e;let r=localStorage.getItem("token");t(e=>e.map(e=>({...e,read:!0}))),o(0),await fetch("".concat(x,"/api/notification/mark-all"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(r)}}),null==(e=(0,n.Ol)())||e.emit("all-read")},f=async e=>{var r;let s=localStorage.getItem("token");t(t=>t.filter(t=>t._id!==e)),await fetch("".concat(x,"/api/notification/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s)}}),null==(r=(0,n.Ol)())||r.emit("delete-one",{id:e})},g=async()=>{var e;let r=localStorage.getItem("token");t([]),o(0),await fetch("".concat(x,"/api/notification/delete-all"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}}),null==(e=(0,n.Ol)())||e.emit("delete-all")};return(0,s.jsxs)("div",{className:"w-full bg-[#f5f5f5] py-3 px-4 border-b flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-black",children:"Reported Content"}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsxs)("div",{className:"relative",ref:d,children:[(0,s.jsxs)("div",{className:"cursor-pointer relative",onClick:()=>{let e=!c;i(e),e&&u()},children:[(0,s.jsx)(l.A,{className:"h-7 w-7 text-yellow-500"}),r>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 h-4 w-4 bg-red-600 text-white    text-[10px] flex items-center justify-center rounded-full border-2 border-white",children:r})]}),c&&(0,s.jsxs)("div",{className:"absolute right-0 mt-3 w-[330px] bg-white shadow-lg border rounded-lg p-3 z-50",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("h2",{className:"font-semibold",children:"Notifications"}),(0,s.jsx)("button",{onClick:u,className:"text-blue-600 text-sm",children:"Mark all read"})]}),(0,s.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:0===e.length?(0,s.jsx)("p",{className:"text-center text-gray-500 py-3",children:"No notifications"}):e.map(e=>(0,s.jsxs)("div",{className:"p-3 border-b flex justify-between items-start ".concat(e.read?"":"bg-yellow-50"),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.message}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(e.createdAt).toLocaleString()}),!e.read&&(0,s.jsx)("button",{onClick:()=>h(e._id),className:"text-blue-600 text-xs mt-1",children:"Mark as read"})]}),(0,s.jsx)("button",{onClick:()=>f(e._id),className:"text-red-500 text-sm",children:"Delete"})]},e._id))}),e.length>0&&(0,s.jsx)("button",{onClick:g,className:"w-full text-red-600 mt-2 py-2 text-sm border-t",children:"Delete All"})]})]})})]})};var c=r(9516),i=r(4250),d=r.n(i),x=r(151);let m=e=>{let{report:t,onClose:r,refreshReports:a}=e;if(!t)return null;let{reporter:l,reportedUser:n,title:o,description:c,image:i,status:m,createdAt:p}=t,h=async e=>{try{let s=await fetch("".concat(x.H,"/admin/report/status/").concat(t._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"approve"===e?"approved":"rejected"})}),l=await s.json();console.log("API Response:",l),l.success?(alert("Report has been ".concat("approve"===e?"approved":"rejected")),r(),a()):alert(l.message||"Something went wrong")}catch(e){console.error("Error in handleAction:",e),alert("Error processing action")}};return(0,s.jsxs)("div",{id:"backdrop",onClick:e=>{"backdrop"===e.target.id&&r()},className:"jsx-335342c2f5390679 fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4 py-10",children:[(0,s.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-335342c2f5390679 relative bg-white/90 backdrop-blur-lg border border-white/40 rounded-3xl shadow-2xl max-w-xl w-full p-8 animate-scaleIn",children:[(0,s.jsxs)("div",{className:"jsx-335342c2f5390679 flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{className:"jsx-335342c2f5390679 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"jsx-335342c2f5390679 "+"w-3 h-3 rounded-full ".concat("rejected"===m?"bg-red-500":"approved"===m?"bg-green-500":"bg-yellow-400")}),(0,s.jsx)("span",{className:"jsx-335342c2f5390679 text-sm font-medium capitalize text-gray-800",children:m})]}),(0,s.jsxs)("span",{className:"jsx-335342c2f5390679 text-sm text-gray-600",children:["Reported on: ",new Date(p).toLocaleDateString()]})]}),(0,s.jsx)("div",{className:"jsx-335342c2f5390679 grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6",children:[n,l].map((e,t)=>(0,s.jsxs)("div",{className:"jsx-335342c2f5390679 bg-white rounded-xl border border-gray-200 p-5 flex flex-col items-center text-center hover:shadow-md transition",children:[(0,s.jsx)("img",{src:(null==e?void 0:e.avatar)||(null==e?void 0:e.profileImage)||"/default-profile.png",alt:"User",className:"jsx-335342c2f5390679 w-20 h-20 rounded-full border object-cover shadow"}),(0,s.jsx)("h3",{className:"jsx-335342c2f5390679 font-semibold text-lg text-gray-800 mt-3",children:(null==e?void 0:e.name)||(null==e?void 0:e.fullName)||"Unnamed User"}),(0,s.jsx)("p",{className:"jsx-335342c2f5390679 text-xs text-blue-500 mt-1",children:1===t?"Reporter":"Reported User"})]},t))}),(0,s.jsxs)("div",{className:"jsx-335342c2f5390679 mb-4",children:[(0,s.jsx)("h4",{className:"jsx-335342c2f5390679 font-semibold text-base mb-1",children:"Reason:"}),(0,s.jsx)("p",{className:"jsx-335342c2f5390679 text-sm text-gray-700 leading-relaxed bg-gray-100 border border-gray-200 rounded-lg p-4 mt-1",children:o}),(0,s.jsx)("h4",{className:"jsx-335342c2f5390679 font-semibold text-base mb-1 mt-4",children:"Description:"}),(0,s.jsx)("p",{className:"jsx-335342c2f5390679 text-sm text-gray-700 leading-relaxed bg-gray-100 border border-gray-200 rounded-lg p-4 mt-1",children:c})]}),(null==i?void 0:i.length)>0&&(0,s.jsxs)("div",{className:"jsx-335342c2f5390679 mb-4",children:[(0,s.jsxs)("h4",{className:"jsx-335342c2f5390679 text-sm font-semibold text-gray-800 mb-2",children:["Attached Screenshot",i.length>1?"s":"",":"]}),(0,s.jsx)("div",{className:"jsx-335342c2f5390679 flex flex-wrap gap-2",children:i.map((e,t)=>(0,s.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"jsx-335342c2f5390679 text-sm text-blue-600 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-md transition",children:["\uD83D\uDCCE Screenshot_",t+1,".jpg"]},t))})]}),(0,s.jsxs)("div",{className:"jsx-335342c2f5390679 flex justify-end gap-4 mt-8",children:[(0,s.jsx)("button",{onClick:()=>h("approve"),className:"jsx-335342c2f5390679 bg-green-500 hover:bg-green-600 text-white px-5 py-2 rounded-full font-semibold shadow",children:"Approve"}),(0,s.jsx)("button",{onClick:()=>h("reject"),className:"jsx-335342c2f5390679 bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-full font-semibold shadow",children:"Reject"})]})]}),(0,s.jsx)(d(),{id:"335342c2f5390679",children:".animate-scaleIn.jsx-335342c2f5390679{animation:scaleIn.3s ease-out}@keyframes scaleIn{0%{transform:scale(.95);opacity:0}100%{transform:scale(1);opacity:1}}"})]})},p=e=>{let{active:t,direction:r}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center ml-1 mt-[2px] leading-[0.4]",children:[(0,s.jsx)("div",{className:"w-2 h-2 rotate-45 border-t-2 border-l-2 ".concat(t&&"asc"===r?"border-gray-700":"border-gray-400")}),(0,s.jsx)("div",{className:"w-2 h-2 rotate-45 border-b-2 border-r-2 mt-[3px] ".concat(t&&"desc"===r?"border-gray-700":"border-gray-400")})]})},h=e=>{let{report:t,currentPage:r,totalPages:l,setCurrentPage:n,refreshReports:o}=e,[c,i]=(0,a.useState)(null),[d,x]=(0,a.useState)({key:null,direction:"asc"}),h=e=>{x(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}))},u=(0,a.useMemo)(()=>d.key?[...t].sort((e,t)=>{var r,s,a,l,n,o,c,i;let x="",m="";switch(d.key){case"reportedUser":x=(null==(r=e.reportedUser)?void 0:r.fullName)||(null==(s=e.reportedUser)?void 0:s.name)||"",m=(null==(a=t.reportedUser)?void 0:a.fullName)||(null==(l=t.reportedUser)?void 0:l.name)||"";break;case"reportDate":x=new Date(e.createdAt),m=new Date(t.createdAt);break;case"reporterUser":x=(null==(n=e.reporter)?void 0:n.fullName)||(null==(o=e.reporter)?void 0:o.name)||"",m=(null==(c=t.reporter)?void 0:c.fullName)||(null==(i=t.reporter)?void 0:i.name)||""}return x<m?"asc"===d.direction?-1:1:x>m?"asc"===d.direction?1:-1:0}):t,[t,d]),f=e=>(null==e?void 0:e.profileImage)||"/default-profile.png",g=e=>(null==e?void 0:e.fullName)||(null==e?void 0:e.name)||"Unknown User",j=e=>(null==e?void 0:e.userId)?"#".concat(e.userId):"#------",b=e=>(null==e?void 0:e.gender)||"N/A";return(0,s.jsxs)("div",{className:"bg-white  px-1",children:[(0,s.jsx)("div",{className:"w-full h-[1px] bg-gray-500 mb-2"}),(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:" border-b border-gray-500",children:[(0,s.jsx)("th",{className:"py-3 px-2 cursor-pointer font-semibold",onClick:()=>h("reportedUser"),children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:["Reported User",(0,s.jsx)(p,{active:"reportedUser"===d.key,direction:d.direction})]})}),(0,s.jsx)("th",{className:"py-3 px-2 cursor-pointer font-semibold",onClick:()=>h("reportDate"),children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:["Report Date",(0,s.jsx)(p,{active:"reportDate"===d.key,direction:d.direction})]})}),(0,s.jsx)("th",{className:"py-3 px-2 cursor-pointer font-semibold",onClick:()=>h("reporterUser"),children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:["Reporter User",(0,s.jsx)(p,{active:"reporterUser"===d.key,direction:d.direction})]})}),(0,s.jsx)("th",{className:"py-3 px-2 font-semibold",children:"Reason"}),(0,s.jsx)("th",{className:"py-3 px-2 font-semibold",children:"Status"}),(0,s.jsx)("th",{className:"py-3 px-2 font-semibold",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:u.map(e=>(0,s.jsxs)("tr",{className:"border-t border-gray-300 hover:bg-gray-50 transition",children:[(0,s.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:f(e.reportedUser),className:"w-11 h-11 rounded-full object-cover"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold",children:g(e.reportedUser)}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[j(e.reportedUser)," /"," ",b(e.reportedUser)]})]})]})}),(0,s.jsx)("td",{className:"py-[14px] px-3 align-middle",children:new Date(e.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"})}),(0,s.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:f(e.reporter),className:"w-11 h-11 rounded-full object-cover"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold",children:g(e.reporter)}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[j(e.reporter)," / ",b(e.reporter)]})]})]})}),(0,s.jsx)("td",{className:"py-[14px] px-3 align-middle",children:e.title}),(0,s.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded-full ".concat((e=>"approved"===(e=null==e?void 0:e.toLowerCase())?"bg-green-500":"pending"===e?"bg-yellow-500":"bg-red-500")(e.status))}),(0,s.jsx)("span",{children:e.status})]})}),(0,s.jsx)("td",{className:"py-[14px] px-3 align-middle",children:(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsx)("button",{className:"text-gray-700",onClick:()=>i(e),children:"View"})})})]},e._id))})]}),(0,s.jsxs)("div",{className:"flex justify-center items-center gap-3 mt-4 text-sm",children:[(0,s.jsx)("button",{disabled:1===r,onClick:()=>n(r-1),children:"◀ Prev"}),[...Array(l)].map((e,t)=>(0,s.jsx)("button",{onClick:()=>n(t+1),className:"".concat(r===t+1?"font-bold underline":"text-gray-600"),children:t+1},t)),(0,s.jsx)("span",{children:"....."}),(0,s.jsx)("button",{disabled:r===l,onClick:()=>n(r+1),children:"Next ▶"})]}),c&&(0,s.jsx)(m,{report:c,onClose:()=>i(null),refreshReports:o})]})},u=()=>{let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)(""),[n,o]=(0,a.useState)("all"),[i,d]=(0,a.useState)(""),[m,p]=(0,a.useState)(1),[u,f]=(0,a.useState)(1),g=async()=>{try{let e=await fetch("".concat(x.H,"/admin/report-analize?search=").concat(r,"&status=").concat(n,"&gender=").concat(i,"&page=").concat(m,"&limit=").concat(10)),s=await e.json();t(s.reports||[]),f(s.totalPages||1)}catch(e){console.error("Failed to fetch reports:",e)}};(0,a.useEffect)(()=>{g()},[r,n,i,m]);let j=e.length,b=e.filter(e=>{var t;return(null==(t=e.status)?void 0:t.toLowerCase())==="pending"}).length,v=e.filter(e=>{var t,r;return(null==(t=e.status)?void 0:t.toLowerCase())==="reviewed"||(null==(r=e.status)?void 0:r.toLowerCase())==="approved"}).length,N=e.filter(e=>{var t;return(null==(t=e.status)?void 0:t.toLowerCase())==="blocked"}).length;return(0,s.jsxs)("div",{className:"p-5",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 px-10 mb-10",children:[{label:"Total Reports This Week",value:j},{label:"Pending Report Review",value:b},{label:"Action Taken",value:v},{label:"Blocked User",value:N}].map(e=>{let{label:t,value:r}=e;return(0,s.jsxs)("div",{className:"bg-white border border-gray-300 rounded-xl shadow-sm p-6 flex flex-col justify-center items-center",style:{height:"150px"},children:[(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-800 text-center",children:t}),(0,s.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-4",children:(e=>e>=1e3?(e/1e3).toFixed(1)+" K":e)(r)})]},t)})}),(0,s.jsxs)("div",{className:"border mt-5 p-4 bg-white border-gray-400 rounded",children:[(0,s.jsx)("div",{className:"bg-gray-100 p-2 rounded-lg shadow-sm border border-gray-400 mb-2",children:(0,s.jsxs)("div",{className:" flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,s.jsxs)("div",{className:" relative w-full  md:max-w-sm",children:[(0,s.jsx)(c.A,{className:" absolute left-3 top-1/2 transform -translate-y-1/2  text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Search by name or email",value:r,onChange:e=>{p(1),l(e.target.value)},className:"w-full pl-10 pr-4 py-2  bg-white border  border-gray-400 rounded-lg focus:ring-2 focus:ring-gray-200"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsxs)("select",{value:n,onChange:e=>{p(1),o(e.target.value)},className:"px-3 py-2 border bg-gray-300 border-gray-400 rounded-lg",children:[(0,s.jsx)("option",{value:"all",children:" Status"}),(0,s.jsx)("option",{value:"pending",children:"Pending"}),(0,s.jsx)("option",{value:"approved",children:"Approved"}),(0,s.jsx)("option",{value:"blocked",children:"Blocked"})]}),(0,s.jsxs)("select",{value:i,onChange:e=>{p(1),d(e.target.value)},className:"px-3 py-2 border bg-gray-300 border-gray-400 rounded-lg",children:[(0,s.jsx)("option",{value:"",children:" Genders"}),(0,s.jsx)("option",{value:"Male",children:"Male"}),(0,s.jsx)("option",{value:"Female",children:"Female"})]})]})]})}),(0,s.jsx)(h,{report:e,currentPage:m,totalPages:u,setCurrentPage:p,itemsPerPage:10,refreshReports:g})]})]})},f=()=>(0,s.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,s.jsx)("div",{className:"shadow-md sticky top-0 z-30 bg-[#f5f5f5]",children:(0,s.jsx)(o,{})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)(u,{})})]})}},e=>{e.O(0,[692,151,636,593,792],()=>e(e.s=3703)),_N_E=e.O()}]);